/*
 * To change this license header, choose License Headers in Project Properties.
 * To change this template file, choose Tools | Templates
 * and open the template in the editor.
 */
package cwms.ui;

import cwms.DataLayer.Common.ConnectionType;
import cwms.DataLayer.Common.DataBase;
import cwms.DataLayer.DataAccess;
import cwms.controller.JobHandler;
import static java.lang.Thread.sleep;
import java.sql.Connection;
import java.sql.PreparedStatement;
import java.sql.ResultSet;
import java.util.Calendar;
import java.util.GregorianCalendar;
import java.util.regex.Pattern;
import javax.swing.JOptionPane;
import javax.swing.table.DefaultTableModel;

/**
 *
 * @author Asanka
 */
public class AddJob extends javax.swing.JFrame {

  
       Connection con = null;
      private DefaultTableModel dtm;
       DataAccess da = new DataAccess();
     
    public AddJob() {
        initComponents();
         DataBase db=new DataBase(ConnectionType.MYSQL);
         con = db.getConnection();
        currentDate();
        fillcombo();
        ServiceID();
        ShowServiceID();
        dtm = (DefaultTableModel) jTable1.getModel();
      
        
        
        
    }

    /**
     * This method is called from within the constructor to initialize the form.
     * WARNING: Do NOT modify this code. The content of this method is always
     * regenerated by the Form Editor.
     */
    @SuppressWarnings("unchecked")
    // <editor-fold defaultstate="collapsed" desc="Generated Code">//GEN-BEGIN:initComponents
    private void initComponents() {

        jPanel1 = new javax.swing.JPanel();
        jLabel106 = new javax.swing.JLabel();
        jButton76 = new javax.swing.JButton();
        jButton77 = new javax.swing.JButton();
        jobpricetxt = new javax.swing.JTextField();
        jLabel108 = new javax.swing.JLabel();
        selectjobcmb = new javax.swing.JComboBox<String>();
        jLabel109 = new javax.swing.JLabel();
        vehcategorytxt = new javax.swing.JTextField();
        jLabel110 = new javax.swing.JLabel();
        jLabel112 = new javax.swing.JLabel();
        jLabel113 = new javax.swing.JLabel();
        timelbl = new javax.swing.JLabel();
        datelbl = new javax.swing.JLabel();
        exitbtn = new javax.swing.JButton();
        addbtn = new javax.swing.JButton();
        deletebtn = new javax.swing.JButton();
        jLabel116 = new javax.swing.JLabel();
        vehregnotxt = new javax.swing.JTextField();
        jLabel117 = new javax.swing.JLabel();
        cusnametxt = new javax.swing.JTextField();
        jLabel118 = new javax.swing.JLabel();
        cusidtxt = new javax.swing.JTextField();
        insertbtn = new javax.swing.JButton();
        jScrollPane1 = new javax.swing.JScrollPane();
        jTable1 = new javax.swing.JTable();
        jLabel119 = new javax.swing.JLabel();
        totalamounttxt = new javax.swing.JTextField();
        jLabel121 = new javax.swing.JLabel();
        endbtn = new javax.swing.JButton();
        clearbtn = new javax.swing.JButton();
        jLabel122 = new javax.swing.JLabel();
        servicenolbl = new javax.swing.JLabel();
        jobstatuslbl = new javax.swing.JLabel();
        jButton1 = new javax.swing.JButton();
        previousservicenolbl = new javax.swing.JLabel();

        setDefaultCloseOperation(javax.swing.WindowConstants.EXIT_ON_CLOSE);

        jPanel1.setBackground(new java.awt.Color(25, 77, 25));

        jLabel106.setFont(new java.awt.Font("Microsoft JhengHei", 1, 24)); // NOI18N
        jLabel106.setForeground(new java.awt.Color(255, 255, 255));
        jLabel106.setText("Add Job");

        jButton76.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                jButton76ActionPerformed(evt);
            }
        });

        jButton77.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                jButton77ActionPerformed(evt);
            }
        });

        jobpricetxt.setFont(new java.awt.Font("Microsoft JhengHei", 1, 14)); // NOI18N

        jLabel108.setFont(new java.awt.Font("Microsoft JhengHei", 1, 14)); // NOI18N
        jLabel108.setForeground(new java.awt.Color(255, 255, 255));
        jLabel108.setText("Job :");

        selectjobcmb.setFont(new java.awt.Font("Microsoft JhengHei", 1, 14)); // NOI18N
        selectjobcmb.setModel(new javax.swing.DefaultComboBoxModel(new String[] { "Select Job", " " }));
        selectjobcmb.addPopupMenuListener(new javax.swing.event.PopupMenuListener() {
            public void popupMenuCanceled(javax.swing.event.PopupMenuEvent evt) {
            }
            public void popupMenuWillBecomeInvisible(javax.swing.event.PopupMenuEvent evt) {
                selectjobcmbPopupMenuWillBecomeInvisible(evt);
            }
            public void popupMenuWillBecomeVisible(javax.swing.event.PopupMenuEvent evt) {
            }
        });
        selectjobcmb.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                selectjobcmbActionPerformed(evt);
            }
        });

        jLabel109.setFont(new java.awt.Font("Microsoft JhengHei", 1, 14)); // NOI18N
        jLabel109.setForeground(new java.awt.Color(255, 255, 255));
        jLabel109.setText("Vehicle Category :");

        vehcategorytxt.setFont(new java.awt.Font("Microsoft JhengHei", 1, 14)); // NOI18N

        jLabel110.setFont(new java.awt.Font("Microsoft JhengHei", 1, 14)); // NOI18N
        jLabel110.setForeground(new java.awt.Color(255, 255, 255));
        jLabel110.setText("Job Price :");

        jLabel112.setFont(new java.awt.Font("Microsoft JhengHei", 1, 14)); // NOI18N
        jLabel112.setForeground(new java.awt.Color(255, 255, 255));
        jLabel112.setText("Time");

        jLabel113.setFont(new java.awt.Font("Microsoft JhengHei", 1, 14)); // NOI18N
        jLabel113.setForeground(new java.awt.Color(255, 255, 255));
        jLabel113.setText("Date");

        timelbl.setFont(new java.awt.Font("Microsoft JhengHei", 1, 14)); // NOI18N
        timelbl.setForeground(new java.awt.Color(255, 255, 255));
        timelbl.setText("10.23 AM");

        datelbl.setFont(new java.awt.Font("Microsoft JhengHei", 1, 14)); // NOI18N
        datelbl.setForeground(new java.awt.Color(255, 255, 255));
        datelbl.setText("31-08-2017");

        exitbtn.setFont(new java.awt.Font("Microsoft JhengHei", 0, 11)); // NOI18N
        exitbtn.setText("Exit");
        exitbtn.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                exitbtnActionPerformed(evt);
            }
        });

        addbtn.setFont(new java.awt.Font("Microsoft JhengHei", 0, 14)); // NOI18N
        addbtn.setText("Add Job");
        addbtn.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                addbtnActionPerformed(evt);
            }
        });

        deletebtn.setFont(new java.awt.Font("Microsoft JhengHei", 0, 14)); // NOI18N
        deletebtn.setText("Delete");
        deletebtn.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                deletebtnActionPerformed(evt);
            }
        });

        jLabel116.setFont(new java.awt.Font("Microsoft JhengHei", 1, 14)); // NOI18N
        jLabel116.setForeground(new java.awt.Color(255, 255, 255));
        jLabel116.setText("Customer ID :");

        vehregnotxt.setFont(new java.awt.Font("Microsoft JhengHei", 1, 14)); // NOI18N
        vehregnotxt.addKeyListener(new java.awt.event.KeyAdapter() {
            public void keyReleased(java.awt.event.KeyEvent evt) {
                vehregnotxtKeyReleased(evt);
            }
        });

        jLabel117.setFont(new java.awt.Font("Microsoft JhengHei", 1, 14)); // NOI18N
        jLabel117.setForeground(new java.awt.Color(255, 255, 255));
        jLabel117.setText("Vehicle Registration No :");

        cusnametxt.setFont(new java.awt.Font("Microsoft JhengHei", 1, 14)); // NOI18N
        cusnametxt.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                cusnametxtActionPerformed(evt);
            }
        });
        cusnametxt.addKeyListener(new java.awt.event.KeyAdapter() {
            public void keyReleased(java.awt.event.KeyEvent evt) {
                cusnametxtKeyReleased(evt);
            }
        });

        jLabel118.setFont(new java.awt.Font("Microsoft JhengHei", 1, 14)); // NOI18N
        jLabel118.setForeground(new java.awt.Color(255, 255, 255));
        jLabel118.setText("Customer Name :");

        cusidtxt.setEditable(false);
        cusidtxt.setFont(new java.awt.Font("Microsoft JhengHei", 1, 14)); // NOI18N
        cusidtxt.setFocusable(false);

        insertbtn.setFont(new java.awt.Font("Microsoft JhengHei", 0, 14)); // NOI18N
        insertbtn.setText("Insert");
        insertbtn.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                insertbtnActionPerformed(evt);
            }
        });

        jTable1.setModel(new javax.swing.table.DefaultTableModel(
            new Object [][] {

            },
            new String [] {
                "Job Description", "Price"
            }
        ) {
            boolean[] canEdit = new boolean [] {
                false, false
            };

            public boolean isCellEditable(int rowIndex, int columnIndex) {
                return canEdit [columnIndex];
            }
        });
        jScrollPane1.setViewportView(jTable1);

        jLabel119.setFont(new java.awt.Font("Microsoft JhengHei", 1, 14)); // NOI18N
        jLabel119.setForeground(new java.awt.Color(255, 255, 255));
        jLabel119.setText("Total Amount :");

        totalamounttxt.setFont(new java.awt.Font("Microsoft JhengHei", 1, 14)); // NOI18N

        jLabel121.setFont(new java.awt.Font("Microsoft JhengHei", 1, 14)); // NOI18N
        jLabel121.setForeground(new java.awt.Color(255, 255, 255));
        jLabel121.setText("Job Status :");

        endbtn.setFont(new java.awt.Font("Microsoft JhengHei", 0, 14)); // NOI18N
        endbtn.setText("End Job");
        endbtn.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                endbtnActionPerformed(evt);
            }
        });

        clearbtn.setFont(new java.awt.Font("Microsoft JhengHei", 0, 14)); // NOI18N
        clearbtn.setText("Clear");
        clearbtn.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                clearbtnActionPerformed(evt);
            }
        });

        jLabel122.setFont(new java.awt.Font("Microsoft JhengHei", 1, 14)); // NOI18N
        jLabel122.setForeground(new java.awt.Color(255, 255, 255));
        jLabel122.setText("Service No :");

        servicenolbl.setFont(new java.awt.Font("Microsoft JhengHei", 1, 18)); // NOI18N
        servicenolbl.setForeground(new java.awt.Color(255, 255, 255));

        jobstatuslbl.setFont(new java.awt.Font("Microsoft JhengHei", 1, 18)); // NOI18N
        jobstatuslbl.setForeground(new java.awt.Color(255, 0, 0));

        jButton1.setFont(new java.awt.Font("Microsoft JhengHei", 0, 14)); // NOI18N
        jButton1.setText("Schedule Employees");
        jButton1.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                jButton1ActionPerformed(evt);
            }
        });

        javax.swing.GroupLayout jPanel1Layout = new javax.swing.GroupLayout(jPanel1);
        jPanel1.setLayout(jPanel1Layout);
        jPanel1Layout.setHorizontalGroup(
            jPanel1Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(jPanel1Layout.createSequentialGroup()
                .addGroup(jPanel1Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING, false)
                    .addGroup(jPanel1Layout.createSequentialGroup()
                        .addGroup(jPanel1Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                            .addGroup(javax.swing.GroupLayout.Alignment.TRAILING, jPanel1Layout.createSequentialGroup()
                                .addContainerGap()
                                .addComponent(jLabel117))
                            .addGroup(jPanel1Layout.createSequentialGroup()
                                .addGroup(jPanel1Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                                    .addGroup(jPanel1Layout.createSequentialGroup()
                                        .addGap(109, 109, 109)
                                        .addGroup(jPanel1Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.TRAILING)
                                            .addComponent(jLabel108)
                                            .addComponent(jLabel118)
                                            .addComponent(jLabel110, javax.swing.GroupLayout.PREFERRED_SIZE, 72, javax.swing.GroupLayout.PREFERRED_SIZE)))
                                    .addGroup(jPanel1Layout.createSequentialGroup()
                                        .addGap(28, 28, 28)
                                        .addComponent(jLabel106, javax.swing.GroupLayout.PREFERRED_SIZE, 170, javax.swing.GroupLayout.PREFERRED_SIZE)))
                                .addGap(0, 9, Short.MAX_VALUE)))
                        .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.UNRELATED)
                        .addGroup(jPanel1Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING, false)
                            .addGroup(javax.swing.GroupLayout.Alignment.TRAILING, jPanel1Layout.createSequentialGroup()
                                .addComponent(addbtn)
                                .addGap(18, 18, 18)
                                .addComponent(endbtn)
                                .addGap(622, 622, 622)
                                .addComponent(exitbtn, javax.swing.GroupLayout.PREFERRED_SIZE, 88, javax.swing.GroupLayout.PREFERRED_SIZE))
                            .addComponent(jScrollPane1, javax.swing.GroupLayout.PREFERRED_SIZE, 963, javax.swing.GroupLayout.PREFERRED_SIZE)
                            .addGroup(javax.swing.GroupLayout.Alignment.TRAILING, jPanel1Layout.createSequentialGroup()
                                .addGroup(jPanel1Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.TRAILING)
                                    .addGroup(javax.swing.GroupLayout.Alignment.LEADING, jPanel1Layout.createSequentialGroup()
                                        .addComponent(jobpricetxt, javax.swing.GroupLayout.PREFERRED_SIZE, 104, javax.swing.GroupLayout.PREFERRED_SIZE)
                                        .addGap(0, 0, Short.MAX_VALUE))
                                    .addGroup(jPanel1Layout.createSequentialGroup()
                                        .addGroup(jPanel1Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                                            .addGroup(jPanel1Layout.createSequentialGroup()
                                                .addGroup(jPanel1Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.TRAILING)
                                                    .addComponent(jLabel116)
                                                    .addGroup(jPanel1Layout.createSequentialGroup()
                                                        .addComponent(vehregnotxt, javax.swing.GroupLayout.PREFERRED_SIZE, 104, javax.swing.GroupLayout.PREFERRED_SIZE)
                                                        .addGap(108, 108, 108)
                                                        .addComponent(jLabel109)))
                                                .addGap(26, 26, 26)
                                                .addGroup(jPanel1Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.TRAILING)
                                                    .addComponent(cusidtxt, javax.swing.GroupLayout.PREFERRED_SIZE, 120, javax.swing.GroupLayout.PREFERRED_SIZE)
                                                    .addComponent(vehcategorytxt, javax.swing.GroupLayout.PREFERRED_SIZE, 120, javax.swing.GroupLayout.PREFERRED_SIZE)))
                                            .addComponent(cusnametxt, javax.swing.GroupLayout.PREFERRED_SIZE, 200, javax.swing.GroupLayout.PREFERRED_SIZE))
                                        .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED, javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE)
                                        .addGroup(jPanel1Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.TRAILING)
                                            .addComponent(jLabel122)
                                            .addComponent(jLabel121))))
                                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                                .addGroup(jPanel1Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                                    .addGroup(jPanel1Layout.createSequentialGroup()
                                        .addComponent(servicenolbl)
                                        .addGap(134, 134, 134)
                                        .addGroup(jPanel1Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                                            .addGroup(jPanel1Layout.createSequentialGroup()
                                                .addComponent(jLabel112)
                                                .addGap(18, 18, 18)
                                                .addComponent(timelbl))
                                            .addGroup(jPanel1Layout.createSequentialGroup()
                                                .addComponent(jLabel113)
                                                .addGap(18, 18, 18)
                                                .addComponent(datelbl))))
                                    .addComponent(jobstatuslbl)))
                            .addComponent(selectjobcmb, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)))
                    .addGroup(jPanel1Layout.createSequentialGroup()
                        .addGap(518, 518, 518)
                        .addGroup(jPanel1Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.TRAILING)
                            .addComponent(jLabel119)
                            .addGroup(jPanel1Layout.createSequentialGroup()
                                .addComponent(clearbtn, javax.swing.GroupLayout.PREFERRED_SIZE, 114, javax.swing.GroupLayout.PREFERRED_SIZE)
                                .addGap(18, 18, 18)
                                .addComponent(deletebtn)))
                        .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.UNRELATED)
                        .addComponent(totalamounttxt, javax.swing.GroupLayout.PREFERRED_SIZE, 104, javax.swing.GroupLayout.PREFERRED_SIZE)))
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED, 28, Short.MAX_VALUE)
                .addComponent(jButton76, javax.swing.GroupLayout.PREFERRED_SIZE, 45, javax.swing.GroupLayout.PREFERRED_SIZE)
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.UNRELATED)
                .addComponent(jButton77, javax.swing.GroupLayout.PREFERRED_SIZE, 45, javax.swing.GroupLayout.PREFERRED_SIZE)
                .addGap(24, 24, 24))
            .addGroup(javax.swing.GroupLayout.Alignment.TRAILING, jPanel1Layout.createSequentialGroup()
                .addGap(0, 0, Short.MAX_VALUE)
                .addComponent(insertbtn, javax.swing.GroupLayout.PREFERRED_SIZE, 114, javax.swing.GroupLayout.PREFERRED_SIZE)
                .addGap(35, 35, 35)
                .addComponent(jButton1, javax.swing.GroupLayout.PREFERRED_SIZE, 182, javax.swing.GroupLayout.PREFERRED_SIZE)
                .addGap(508, 508, 508))
        );
        jPanel1Layout.setVerticalGroup(
            jPanel1Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(jPanel1Layout.createSequentialGroup()
                .addGroup(jPanel1Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                    .addGroup(jPanel1Layout.createSequentialGroup()
                        .addGroup(jPanel1Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                            .addGroup(jPanel1Layout.createSequentialGroup()
                                .addGap(23, 23, 23)
                                .addComponent(jLabel106)
                                .addGap(18, 18, 18)
                                .addGroup(jPanel1Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
                                    .addComponent(jLabel117)
                                    .addComponent(vehregnotxt, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE))
                                .addGap(14, 14, 14))
                            .addGroup(javax.swing.GroupLayout.Alignment.TRAILING, jPanel1Layout.createSequentialGroup()
                                .addContainerGap()
                                .addGroup(jPanel1Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                                    .addComponent(jLabel109, javax.swing.GroupLayout.Alignment.TRAILING)
                                    .addComponent(vehcategorytxt, javax.swing.GroupLayout.Alignment.TRAILING, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)
                                    .addGroup(javax.swing.GroupLayout.Alignment.TRAILING, jPanel1Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
                                        .addComponent(jLabel122, javax.swing.GroupLayout.PREFERRED_SIZE, 30, javax.swing.GroupLayout.PREFERRED_SIZE)
                                        .addComponent(servicenolbl, javax.swing.GroupLayout.PREFERRED_SIZE, 30, javax.swing.GroupLayout.PREFERRED_SIZE)))
                                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.UNRELATED)))
                        .addGroup(jPanel1Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                            .addGroup(jPanel1Layout.createSequentialGroup()
                                .addGroup(jPanel1Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
                                    .addComponent(jLabel121, javax.swing.GroupLayout.PREFERRED_SIZE, 30, javax.swing.GroupLayout.PREFERRED_SIZE)
                                    .addComponent(jobstatuslbl, javax.swing.GroupLayout.PREFERRED_SIZE, 30, javax.swing.GroupLayout.PREFERRED_SIZE))
                                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED, javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE))
                            .addGroup(javax.swing.GroupLayout.Alignment.TRAILING, jPanel1Layout.createSequentialGroup()
                                .addGroup(jPanel1Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
                                    .addComponent(jLabel118, javax.swing.GroupLayout.PREFERRED_SIZE, 30, javax.swing.GroupLayout.PREFERRED_SIZE)
                                    .addComponent(cusnametxt, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)
                                    .addComponent(cusidtxt, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)
                                    .addComponent(jLabel116, javax.swing.GroupLayout.PREFERRED_SIZE, 30, javax.swing.GroupLayout.PREFERRED_SIZE))
                                .addGap(38, 38, 38)
                                .addComponent(jLabel108)
                                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.UNRELATED)
                                .addGroup(jPanel1Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
                                    .addComponent(jLabel110)
                                    .addComponent(jobpricetxt, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE))
                                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED, 26, Short.MAX_VALUE)
                                .addGroup(jPanel1Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                                    .addComponent(insertbtn, javax.swing.GroupLayout.PREFERRED_SIZE, 39, javax.swing.GroupLayout.PREFERRED_SIZE)
                                    .addComponent(jButton1, javax.swing.GroupLayout.PREFERRED_SIZE, 39, javax.swing.GroupLayout.PREFERRED_SIZE))
                                .addGap(58, 58, 58))))
                    .addGroup(jPanel1Layout.createSequentialGroup()
                        .addGroup(jPanel1Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                            .addGroup(jPanel1Layout.createSequentialGroup()
                                .addGap(40, 40, 40)
                                .addGroup(jPanel1Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
                                    .addComponent(jLabel112)
                                    .addComponent(timelbl))
                                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.UNRELATED)
                                .addGroup(jPanel1Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                                    .addComponent(jLabel113)
                                    .addComponent(datelbl)))
                            .addGroup(jPanel1Layout.createSequentialGroup()
                                .addGap(37, 37, 37)
                                .addGroup(jPanel1Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                                    .addComponent(jButton76, javax.swing.GroupLayout.PREFERRED_SIZE, 42, javax.swing.GroupLayout.PREFERRED_SIZE)
                                    .addComponent(jButton77, javax.swing.GroupLayout.PREFERRED_SIZE, 42, javax.swing.GroupLayout.PREFERRED_SIZE))))
                        .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED, javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE))
                    .addGroup(javax.swing.GroupLayout.Alignment.TRAILING, jPanel1Layout.createSequentialGroup()
                        .addContainerGap(javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE)
                        .addComponent(selectjobcmb, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)
                        .addGap(164, 164, 164)))
                .addComponent(jScrollPane1, javax.swing.GroupLayout.PREFERRED_SIZE, 156, javax.swing.GroupLayout.PREFERRED_SIZE)
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                .addGroup(jPanel1Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
                    .addComponent(jLabel119, javax.swing.GroupLayout.PREFERRED_SIZE, 30, javax.swing.GroupLayout.PREFERRED_SIZE)
                    .addComponent(totalamounttxt, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE))
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED, 7, Short.MAX_VALUE)
                .addGroup(jPanel1Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                    .addGroup(javax.swing.GroupLayout.Alignment.TRAILING, jPanel1Layout.createSequentialGroup()
                        .addGroup(jPanel1Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
                            .addComponent(addbtn, javax.swing.GroupLayout.PREFERRED_SIZE, 45, javax.swing.GroupLayout.PREFERRED_SIZE)
                            .addComponent(endbtn, javax.swing.GroupLayout.PREFERRED_SIZE, 45, javax.swing.GroupLayout.PREFERRED_SIZE))
                        .addGap(103, 103, 103))
                    .addGroup(javax.swing.GroupLayout.Alignment.TRAILING, jPanel1Layout.createSequentialGroup()
                        .addGroup(jPanel1Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.TRAILING)
                            .addGroup(jPanel1Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
                                .addComponent(deletebtn, javax.swing.GroupLayout.PREFERRED_SIZE, 39, javax.swing.GroupLayout.PREFERRED_SIZE)
                                .addComponent(clearbtn, javax.swing.GroupLayout.PREFERRED_SIZE, 39, javax.swing.GroupLayout.PREFERRED_SIZE))
                            .addComponent(exitbtn, javax.swing.GroupLayout.PREFERRED_SIZE, 32, javax.swing.GroupLayout.PREFERRED_SIZE))
                        .addGap(75, 75, 75))))
        );

        previousservicenolbl.setText("pre ser");

        javax.swing.GroupLayout layout = new javax.swing.GroupLayout(getContentPane());
        getContentPane().setLayout(layout);
        layout.setHorizontalGroup(
            layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(layout.createSequentialGroup()
                .addComponent(jPanel1, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.UNRELATED)
                .addComponent(previousservicenolbl)
                .addGap(0, 64, Short.MAX_VALUE))
        );
        layout.setVerticalGroup(
            layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addComponent(jPanel1, javax.swing.GroupLayout.Alignment.TRAILING, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)
            .addGroup(javax.swing.GroupLayout.Alignment.TRAILING, layout.createSequentialGroup()
                .addComponent(previousservicenolbl)
                .addGap(35, 35, 35))
        );

        pack();
    }// </editor-fold>//GEN-END:initComponents

    private void jButton76ActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_jButton76ActionPerformed
        Main m1=new Main();
        m1.setVisible(true);
        this.dispose();
    }//GEN-LAST:event_jButton76ActionPerformed

    private void jButton77ActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_jButton77ActionPerformed
        JobMain m1=new JobMain();
        m1.setVisible(true);
        this.dispose();
    }//GEN-LAST:event_jButton77ActionPerformed

    private void deletebtnActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_deletebtnActionPerformed
        
        
        int x = JOptionPane.showConfirmDialog(null, "Do you want to DELETE");
            
            if(x==0)
            {

            // substract total when item is delete
            int z;
            for (z = 0; z < jTable1.getSelectedRowCount(); z++) {
            double oldtotal = Double.parseDouble(totalamounttxt.getText());
            double total = Double.parseDouble(jTable1.getValueAt(z,1).toString());
            double newtotal = oldtotal - total;
            totalamounttxt.setText(""+newtotal);
             
         }
                
                
                
            // delete selected row    
            try
            {  
                int selectedrow =jTable1.getSelectedRow();
                if (selectedrow>=0){
                    dtm.removeRow(selectedrow);
                }else{
                    
                }
            }
            catch (Exception e)
            {

            } 
            }
                            
    }//GEN-LAST:event_deletebtnActionPerformed

    private void insertbtnActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_insertbtnActionPerformed
        // insert data to jtable
        
        DefaultTableModel dtm = (DefaultTableModel)jTable1.getModel();
        dtm.addRow(new Object[]{selectjobcmb.getSelectedItem(),jobpricetxt.getText()});
        
         //
        double total = 0;
        for(int i=0; i<jTable1.getRowCount(); i++)
        {
            double amount = Double.parseDouble((String) jTable1.getValueAt(i, 1));
            total += amount;
        }
      
        totalamounttxt.setText(String.valueOf(total));
         
    }//GEN-LAST:event_insertbtnActionPerformed

    private void selectjobcmbActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_selectjobcmbActionPerformed
            
    }//GEN-LAST:event_selectjobcmbActionPerformed

    private void vehregnotxtKeyReleased(java.awt.event.KeyEvent evt) {//GEN-FIRST:event_vehregnotxtKeyReleased
        // Enter veh reg no then get veh category
        
       DataBase db=new DataBase(ConnectionType.MYSQL);
        Connection conn=db.getConnection();
        
        try {
            String sql = "select * from vehicle where veh_registration_number=?";
            PreparedStatement pst = null;
            pst = conn.prepareStatement(sql);
            pst.setString(1, (String)vehregnotxt.getText());
            pst.execute();
            
            ResultSet rs= pst.executeQuery();
            while (rs.next())
            {
                vehregnotxt.setText(rs.getString("veh_registration_number"));
                vehcategorytxt.setText(rs.getString("veh_category"));
            }
            
        } catch (Exception e) {
            
            e.printStackTrace();
        }
       
    }//GEN-LAST:event_vehregnotxtKeyReleased

    private void cusnametxtKeyReleased(java.awt.event.KeyEvent evt) {//GEN-FIRST:event_cusnametxtKeyReleased
        // enter cus name then get cus id
        
        DataBase db=new DataBase(ConnectionType.MYSQL);
        Connection conn=db.getConnection();
        
        try {
            String sql = "select * from customer where cus_name=?";
            PreparedStatement pst = null;
            pst = conn.prepareStatement(sql);
            pst.setString(1, (String)cusnametxt.getText());
            pst.execute();
            
            ResultSet rs= pst.executeQuery();
            while (rs.next())
            {
                cusnametxt.setText(rs.getString("cus_name"));
                cusidtxt.setText(rs.getString("cus_id"));
            }
            
        } catch (Exception e) {
            
            e.printStackTrace();
        }
        
        
    }//GEN-LAST:event_cusnametxtKeyReleased

    private void cusnametxtActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_cusnametxtActionPerformed
        // TODO add your handling code here:
    }//GEN-LAST:event_cusnametxtActionPerformed

    private void selectjobcmbPopupMenuWillBecomeInvisible(javax.swing.event.PopupMenuEvent evt) {//GEN-FIRST:event_selectjobcmbPopupMenuWillBecomeInvisible
        // Select job and then get job price
         DataBase db=new DataBase(ConnectionType.MYSQL);
        Connection conn=db.getConnection();
        
        String tmp = (String)selectjobcmb.getSelectedItem();
        String sql = "select * from job_prices where job_description=?";
        
        try {
            PreparedStatement pst = null;
            pst = conn.prepareStatement(sql);
            pst.setString(1, tmp);
            ResultSet rs=pst.executeQuery();
            
            if(rs.next())
            {
            String addprice = rs.getString("job_price");
            jobpricetxt.setText(addprice);
            }
        } catch (Exception e) {
            JOptionPane.showMessageDialog(null, e);
        }
    }//GEN-LAST:event_selectjobcmbPopupMenuWillBecomeInvisible

    private void exitbtnActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_exitbtnActionPerformed
        // TODO add your handling code here:
        //JobMain m1=new JobMain();
       // m1.setVisible(true);
        this.dispose();
    }//GEN-LAST:event_exitbtnActionPerformed

    private void addbtnActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_addbtnActionPerformed
        // add to db
        
        int i;

        for (i = 0; i < jTable1.getRowCount(); i++) {
            String jobdescription = jTable1.getValueAt(i, 0).toString();
            double jobamount = Double.parseDouble(jTable1.getValueAt(i,1).toString());
            
         
           
          int prev_serviceid = Integer.parseInt(previousservicenolbl.getText());
          int sid =  prev_serviceid+1;     
          
            String time = timelbl.getText();
            String date = datelbl.getText();
            String cusid = cusidtxt.getText();
            String cusname = cusnametxt.getText();
            String vehregno = vehregnotxt.getText();
            String vehcategory = vehcategorytxt.getText();
            jobstatuslbl.setText("ONGOING");
            String jobstatus = jobstatuslbl.getText();
            double totalamount = Double.parseDouble(totalamounttxt.getText());
            
            //validation
            if(vehcategorytxt.getText().isEmpty() || cusidtxt.getText().isEmpty() || vehregnotxt.getText().isEmpty() || cusnametxt.getText().isEmpty())
            {
                jobstatuslbl.setText("");
                JOptionPane.showMessageDialog(null, "Please enter already registered customer name and vehicle number");
            }
            else
            {
            da.addJob(sid,jobdescription, jobamount, time, date, cusid, cusname, vehregno,vehcategory, jobstatus, totalamount);
            String cmessage = "Do you wish to assign employees to the job?";   
            String conf = "Exit";
            int confirm = JOptionPane.showConfirmDialog(null, cmessage, conf, JOptionPane.YES_NO_OPTION);
            if(confirm == JOptionPane.YES_NO_OPTION)
            {
               ScheduleJob sc=new ScheduleJob(sid);
               sc.setVisible(true);
            }
            }
        }
        
        
    }//GEN-LAST:event_addbtnActionPerformed

    private void endbtnActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_endbtnActionPerformed
         //job status update in end btn
         
         jobstatuslbl.setText("COMPLETED");
         String jobstatus = jobstatuslbl.getText();
         int sid =Integer.parseInt(servicenolbl.getText());
         
         
         da.endJob(jobstatus,sid);
         
         
         this.dispose();
         
        
        
    }//GEN-LAST:event_endbtnActionPerformed

    private void clearbtnActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_clearbtnActionPerformed
         // clear fields
	vehregnotxt.setText("");
        vehcategorytxt.setText("");
        cusnametxt.setText("");
        cusidtxt.setText("");
        selectjobcmb.setSelectedItem("Select Job");
        jobpricetxt.setText("");
        totalamounttxt.setText("");
        jobstatuslbl.setText("");
       
        //clear table
        DefaultTableModel model = (DefaultTableModel) jTable1.getModel();
        model.setRowCount(0);
        
    }//GEN-LAST:event_clearbtnActionPerformed

    private void jButton1ActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_jButton1ActionPerformed
              ScheduleJob sc=new ScheduleJob(Integer.parseInt(servicenolbl.getText().trim()));
               sc.setVisible(true);
    }//GEN-LAST:event_jButton1ActionPerformed
    
    //current time and date
    public void currentDate()
    {
        Thread clock = new Thread ()
        {
            public void run()
            {
                for(;;)
                { 
                    Calendar cal = new GregorianCalendar();
                    int day = cal.get(Calendar.DATE);
                    int month = cal.get(Calendar.MONTH);
                    int year = cal.get(Calendar.YEAR);
                    
                    datelbl.setText(day+"-"+(month+1)+"-"+year);
        
                    int sec = cal.get(Calendar.SECOND);
                    int min = cal.get(Calendar.MINUTE);
                    int hrs = cal.get(Calendar.HOUR);
        
                    timelbl.setText(hrs+":"+min+":"+sec);
                
                    try 
                    {
                        sleep(1000);
                    }
                     catch (Exception e)
                    {
                        
                    }
                }
            }
        };
        
        clock.start();
        {
            
        } 
    }
    
    
    private void fillcombo(){
        
        DataBase db=new DataBase(ConnectionType.MYSQL);
        Connection conn=db.getConnection();
        
        try {
            String sql = "select * from job_prices";
            PreparedStatement pst = null;
            pst = conn.prepareStatement(sql);
            ResultSet rs=pst.executeQuery();
            
            while(rs.next())
            {
            String jobname = rs.getString("job_description");
            selectjobcmb.addItem(jobname);
            }
            
        } catch (Exception e) {
            JOptionPane.showMessageDialog(null, e);
        }
    
    }
    
    public void ServiceID()
    {
        String d="select * from job ORDER BY service_id desc LIMIT 1";
        
              System.out.println(d);
        try {
            PreparedStatement pst = con.prepareStatement(d);
            ResultSet rs = pst.executeQuery();
            rs.next();
            
            previousservicenolbl.setText(rs.getString("service_id"));
             
          
        } catch (Exception e) {
           
        }
    }
    
    public void ShowServiceID()
    {
          int prev_serviceid = Integer.parseInt(previousservicenolbl.getText());
          int sid =  prev_serviceid+1;
          servicenolbl.setText(Integer.toString(sid));
    
    }
    
    
    /**
     * @param args the command line arguments
     */
    public static void main(String args[]) {
        /* Set the Nimbus look and feel */
        //<editor-fold defaultstate="collapsed" desc=" Look and feel setting code (optional) ">
        /* If Nimbus (introduced in Java SE 6) is not available, stay with the default look and feel.
         * For details see http://download.oracle.com/javase/tutorial/uiswing/lookandfeel/plaf.html 
         */
        try {
            for (javax.swing.UIManager.LookAndFeelInfo info : javax.swing.UIManager.getInstalledLookAndFeels()) {
                if ("Nimbus".equals(info.getName())) {
                    javax.swing.UIManager.setLookAndFeel(info.getClassName());
                    break;
                }
            }
        } catch (ClassNotFoundException ex) {
            java.util.logging.Logger.getLogger(AddJob.class.getName()).log(java.util.logging.Level.SEVERE, null, ex);
        } catch (InstantiationException ex) {
            java.util.logging.Logger.getLogger(AddJob.class.getName()).log(java.util.logging.Level.SEVERE, null, ex);
        } catch (IllegalAccessException ex) {
            java.util.logging.Logger.getLogger(AddJob.class.getName()).log(java.util.logging.Level.SEVERE, null, ex);
        } catch (javax.swing.UnsupportedLookAndFeelException ex) {
            java.util.logging.Logger.getLogger(AddJob.class.getName()).log(java.util.logging.Level.SEVERE, null, ex);
        }
        //</editor-fold>
        //</editor-fold>
        //</editor-fold>
        //</editor-fold>

        /* Create and display the form */
        java.awt.EventQueue.invokeLater(new Runnable() {
            public void run() {
                new AddJob().setVisible(true);
            }
        });
    }

    // Variables declaration - do not modify//GEN-BEGIN:variables
    private javax.swing.JButton addbtn;
    private javax.swing.JButton clearbtn;
    private javax.swing.JTextField cusidtxt;
    private javax.swing.JTextField cusnametxt;
    private javax.swing.JLabel datelbl;
    private javax.swing.JButton deletebtn;
    private javax.swing.JButton endbtn;
    private javax.swing.JButton exitbtn;
    private javax.swing.JButton insertbtn;
    private javax.swing.JButton jButton1;
    private javax.swing.JButton jButton76;
    private javax.swing.JButton jButton77;
    private javax.swing.JLabel jLabel106;
    private javax.swing.JLabel jLabel108;
    private javax.swing.JLabel jLabel109;
    private javax.swing.JLabel jLabel110;
    private javax.swing.JLabel jLabel112;
    private javax.swing.JLabel jLabel113;
    private javax.swing.JLabel jLabel116;
    private javax.swing.JLabel jLabel117;
    private javax.swing.JLabel jLabel118;
    private javax.swing.JLabel jLabel119;
    private javax.swing.JLabel jLabel121;
    private javax.swing.JLabel jLabel122;
    private javax.swing.JPanel jPanel1;
    private javax.swing.JScrollPane jScrollPane1;
    private javax.swing.JTable jTable1;
    private javax.swing.JTextField jobpricetxt;
    private javax.swing.JLabel jobstatuslbl;
    private javax.swing.JLabel previousservicenolbl;
    private javax.swing.JComboBox<String> selectjobcmb;
    private javax.swing.JLabel servicenolbl;
    private javax.swing.JLabel timelbl;
    private javax.swing.JTextField totalamounttxt;
    private javax.swing.JTextField vehcategorytxt;
    private javax.swing.JTextField vehregnotxt;
    // End of variables declaration//GEN-END:variables
}
